openapi: 3.0.0
servers:
  - description: test
    url: https://test.foo
info:
  description: ConsoleMe API definition
  version: '2.0.0'
  title: ConsoleMe v2 API
  contact:
    email: psanders@netflix.com
  license:
    name: License TBD
tags:
  - name: roles
    description: Cool role stuff
paths:
  /credentials:
    post:
      summary: generate a federation url for aws console signin
  /requests:
    get:
      summary: get a list of requests
    post:
      summary: submit a new request
  /requests/{id}:
    get:
      summary: get details about a request
    put:
      summary: update a request
  /resources:
    get:
      summary: get resources
  /roles:
    options:
      summary: get endpoint options
      tags:
        - roles
      responses:
        200:
          description: OK
          headers:
            Access-Control-Allow-Headers:
              $ref: '#/components/headers/accessControlAllow'
    get:
      summary: get a list of roles
      tags:
        - roles
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Role'
  /roles/{accountNumber}:
    options:
      summary: get endpoint options
      tags:
        - roles
      parameters:
        - $ref: '#/components/parameters/accountNumber'
      responses:
        200:
          description: OK
          headers:
            Access-Control-Allow-Headers:
              $ref: '#/components/headers/accessControlAllow'
    get:
      summary: get a list of roles in an account
      tags:
        - roles
      parameters:
        - $ref: '#/components/parameters/accountNumber'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Role'
  /roles/{accountNumber}/{roleName}:
    options:
      summary: get endpoint options
      tags:
        - roles
      parameters:
        - $ref: '#/components/parameters/accountNumber'
        - $ref: '#/components/parameters/roleName'
      responses:
        200:
          description: OK
          headers:
            Access-Control-Allow-Headers:
              $ref: '#/components/headers/accessControlAllow'
    get:
      summary: get details about a role
      tags:
        - roles
      parameters:
        - $ref: '#/components/parameters/accountNumber'
        - $ref: '#/components/parameters/roleName'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RoleDetails'
    put:
      summary: update a role
      tags:
        - roles
      parameters:
        - $ref: '#/components/parameters/accountNumber'
        - $ref: '#/components/parameters/roleName'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RoleDetails'
  /roles/{accountNumber}/{roleName}/requests:
    get:
      summary: get a list of requests for a role
      parameters:
        - $ref: '#/components/parameters/accountNumber'
        - $ref: '#/components/parameters/roleName'
  /roles/{accountNumber}/{roleName}/requests/{id}:
    get:
      summary: get details about a request for a role
      parameters:
        - $ref: '#/components/parameters/accountNumber'
        - $ref: '#/components/parameters/roleName'
  /user:
    get:
      summary: get details about current user
components:
  headers:
    accessControlAllow:
      schema:
        type: string
      description: Allowed request headers
  parameters:
    accountNumber:
      name: accountNumber
      in: path
      required: true
      example: 012345678901
      schema:
        type: string
        pattern: '^\d{12}$'
    roleName:
      name: roleName
      in: path
      required: true
      example: fake_account_admin
      schema:
        type: string
  schemas:
    Role:
      type: object
      properties:
        name:
          type: string
          example: super_awesome_admin
        account_id:
          type: string
          minLength: 12
          maxLength: 12
          example: '123456789012'
        account_name:
          type: string
          example: super_awesome
        arn:
          type: string
          example: arn:aws:iam::123456789012:role/super_awesome_admin
    RoleDetails:
      type: object
      properties:
        name:
          type: string
          example: super_awesome_admin
        account_id:
          type: string
          minLength: 12
          maxLength: 12
          example: '123456789012'
        account_name:
          type: string
          example: super_awesome
        arn:
          type: string
          example: arn:aws:iam::123456789012:role/super_awesome_admin
        inline_policies:
          type: array
          items:
            type: object # TODO: make inline_policies schema
        assume_role_policies:
          type: array
          items:
            type: object # TODO: make assume_role_policies schema
        managed_policies:
          type: array
          items:
            type: object # TODO: make managed_policies schema
        tags:
          type: array
          items:
            type: object # TODO: make tags schema
        templated:
          type: boolean
        template_link:
          type: string
