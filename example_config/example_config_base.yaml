access_requests:
  default_approver: admin@example.com
api_auth:
  valid_entities:
    - fake_api_entity
auth_cookie_name: consoleme_auth
application_admin: consoleme_admins@example.com
application_name: consoleme

# We support account aliases, which is why the mapping of account names below is a list
account_ids_to_name:
  "123456789012":
    - default_account
#  "123456789013":
#    - prod
#  "123456789014":
#    - test

auth:
  get_groups_by_header: true
  get_user_by_header: true
  get_user_by_oauth: false
  get_user_by_saml: false
  groups_header_name: group_header
  user_header_name: user_header

# You'll probably want to override FUNCTION to generate this data with your own business logic.
application_settings:
  application_1:
    owner: groupa@example.com
    owner_url: https://www.example.com/groupa@example.com
    app_url: https://www.example.com/ci_cd_pipeline/application_1
    roles:
      - arn:aws:iam::123456789012:role/application_1InstanceProfile
      - arn:aws:iam::123456789013:role/application_1InstanceProfile
  application_2:
    owner: groupa@example.com
    roles:
      - arn:aws:iam::123456789012:role/application_2InstanceProfile

aws:
  console_url: "https://{}.console.aws.amazon.com"
  federation_url: "https://signin.aws.amazon.com/federation"
  iamroles_dynamo_table: consoleme_iamroles_global
  iamroles_redis_key: IAM_ROLE_CACHE
  issuer: YourCompany
  requests_dynamo_table: consoleme_requests_global
  session_duration: 43200

celery:
  active_region: us-west-2 # Some jobs should only run in one region.
  # celery.sync_regions specifies which regions to sync resources from, such as SQS queues and SNS topics
  sync_regions:
    - us-east-1
    - us-west-2
    - eu-west-1
challenge:
  token_expiration: 3600
cli_auth:
  certificate_header: certificate_header
  required_headers:
    - RequiredMTLSHeader: RequiredMTLSHeaderValue

errors:
  custom_max_cert_age_message: "Please refresh your certificate."
get_eligible_roles:
  from_config: true
  from_prefix: false

headers:
  # The Google Groups features do not fully work in the OSS version of ConsoleMe. Please contact the developers if you
  # need this feature.
  group_access:
    enabled: false
  policies:
    enabled: true
  config:
    enabled: true

enable_self_service: true

dynamic_config:
  group_mapping:
    groupa@example.com:
      roles:
        - arn:aws:iam::123456789012:role/roleA
        - arn:aws:iam::123456789012:role/roleB

groups:
  can_edit_config:
    - configeditors@example.com
  can_admin_policies:
    - consoleme_admins@example.com

jwt:
  groups_key: groups
  email_key: email
  expiration_hours: 6

# If desired, you can configure Google Analytics here
# google_analytics:
#    tracking_id: 12345

#google:
#  admin_scopes:
#    - 'https://www.googleapis.com/auth/admin.directory.group'
#  credential_subject:
#    example.com: exampleapiuser@example.com
#    example2.com: exampleapiuser@example2.com
#group_mapping_config:
#  recent_users_key: RECENT_USERS
#  role_cache_expiration: 21600
#  role_cache_redis_key: 'ROLE_CACHE_{}'
#  update_frequency: 300
#groups:
#  attributes:
#    boolean:
#      - label: Requestable
#        name: requestable
#        sensitive: false
#    list:
#      - label: Secondary Approvers
#        name: secondary_approvers
#        placeholder: 'group1@example.com,group2@example.com'
#        sensitive: false
#      - label: Self-approval Groups
#        name: self_approval_groups
#        placeholder: 'group1@example.com,group2@example.com'
#        sensitive: false
#      - label: Emails to notify when users are added
#        name: alert_on_changes
#        placeholder: 'group1@example.com,group2@example.com'
#        sensitive: false
#      - label: Owners
#        name: owner
#        placeholder: 'group1@example.com,group2@example.com'
#        sensitive: false
#  can_admin:
#    - admin@example.com
#  can_admin_policies:
#    - admin@example.com
#  developement_notification_emails:
#    - developer@example.com
#  can_audit:
#    - auditors@example.com
#  can_edit_config:
#    - configeditors@example.com
#  can_edit_policies:
#    - policyeditors@example.com
#  can_edit_sensitive_attributes:
#    - sensitiveattributeeditors@example.com
#  require_bg_check:
#    - sensitivegroup@example.com

plugins:
  auth: default_auth
  aws: default_aws
  group_mapping: default_group_mapping
  internal_celery_tasks: default_celery_tasks
  internal_celery_tasks_functions: default_celery_tasks_functions
  metrics: default_metrics
  internal_config: config
  internal_routes: default_internal_routes
  internal_policies: default_policies

logging_levels:
  asyncio: WARNING
  boto3: CRITICAL
  boto: CRITICAL
  botocore: CRITICAL
  elasticsearch.trace: ERROR
  elasticsearch: ERROR
  nose: CRITICAL
  parso.python.diff: WARNING
  s3transfer: CRITICAL
  spectator.HttpClient: WARNING
  spectator.Registry: WARNING
  urllib3: ERROR

# Warning: Tracing has performance implications. We recommend against 100% sample_rate in a production environment.
# Enabling tracing in development will also override your ability to debug in your IDE. If you're
# running in docker, be sure to start Zipkin at the same time as your other containers
# ex: `docker-compose -f docker-compose.yaml -f docker-compose-dependencies.yaml -f docker-compose-zipkin.yaml up`
# To test, browse to Local ConsoleMe and confirm you see the trace in Zipkin at http://localhost:9411
tracing:
  application_name: consoleme
  enabled: false # False by default, override in account-specific configuration
  sample_rate: 100 # Percentage of requests
  zipkin_address: http://consoleme_zipkin:9411/api/v2/spans
  in_scope_function_calls:
    - /consoleme/

cache_all_resources_from_aws_config:
  aws_config:
    all_resources_query: select * where accountId = '{account_id}'
  redis_key: ALL_RESOURCE_ARNS

aws_config_cache:
  redis_key: AWSCONFIG_RESOURCE_CACHE
  # s3:
  #  bucket: consoleme_bucket
  #  file: aws_config_cache/cache_{account_id}_v1.json

#policies:
#  role_name: ConsoleMeRole

#sso:
#  enabled: true
#  jwk_url: https://provider.example.com/ext/oauth/something/jwks
#  jwk_schema:
#    header:
#      alg:
#        enum:
#          - RS512
#    payload:
#      iss:
#        enum:
#          - https://provider.example.com

# Note: Do not put anything sensitive in the self_service_iam key. This may be exposed to the frontend UI
self_service_iam:
  custom_header_message: |-
    Welcome to the new and improved IAM Self-Service Wizard beta!
    Please click [here](/self_service_v1) if you need to access the older version.
  permissions_map:
    s3:
      text: S3 Bucket
      description: S3 Permissions
      inputs:
        - name: resource_arn
          type: typeahead_input
          text: Bucket Name
          required: true
          typeahead_endpoint: /policies/typeahead?resource=s3&show_full_arn_for_s3_buckets=true&search={query}
        - name: bucket_prefix
          type: text_input
          text: Prefix (Folder under S3 that you need access to).
          required: true
          default: /*
      action_map:
        - name: list
          text: List
          permissions:
            - s3:ListBucket
            - s3:ListBucketVersions
        - name: get
          text: Get
          permissions:
            - s3:GetObject
            - s3:GetObjectTagging
            - s3:GetObjectVersion
            - s3:GetObjectVersionTagging
            - s3:GetObjectAcl
            - s3:GetObjectVersionAcl
        - name: put
          text: Put
          permissions:
            - s3:PutObject
            - s3:PutObjectTagging
            - s3:PutObjectVersionTagging
            - s3:ListMultipartUploadParts*
            - s3:AbortMultipartUpload
        - name: delete
          text: Delete
          permissions:
            - s3:DeleteObject
            - s3:DeleteObjectTagging
            - s3:DeleteObjectVersion
            - s3:DeleteObjectVersionTagging
    sqs:
      text: SQS Queue
      description: ""
      inputs:
        - name: resource_arn
          type: typeahead_input
          text: Queue ARN
          required: true
          typeahead_endpoint: /policies/typeahead?resource=sqs&search={query}
      action_map:
        - name: send_messages
          text: Send Message (Queue Producer)
          permissions:
            - sqs:GetQueueAttributes
            - sqs:GetQueueUrl
            - sqs:SendMessage
        - name: receive_messages
          text: Receive/Delete Messages (Queue Consumer)
          permissions:
            - sqs:GetQueueAttributes
            - sqs:GetQueueUrl
            - sqs:ReceiveMessage
            - sqs:DeleteMessage
        - name: set_queue_attributes
          text: Set Queue Attributes
          permissions:
            - sqs:SetQueueAttributes
    sns:
      text: SNS Topic
      description: ""
      inputs:
        - name: resource_arn
          type: typeahead_input
          text: Topic ARN
          required: true
          typeahead_endpoint: /policies/typeahead?resource=sns&search={query}
      action_map:
        - name: get_topic_attributes
          text: Get Topic Attributes
          permissions:
            - sns:GetEndpointAttributes
            - sns:GetTopicAttributes
        - name: publish
          text: Publish
          permissions:
            - sns:Publish
        - name: subscribe
          text: Subscribe
          permissions:
            - sns:Subscribe
            - sns:ConfirmSubscription
        - name: unsubscribe
          text: Unsubscribe
          permissions:
            - sns:Unsubscribe
    rds:
      text: RDS
      description: ""
      inputs:
        - name: resource_arn
          type: text_input
          text: EC2 resource you need access to
          required: true
          default: "arn:aws:iam::{account_id}:role/rds-monitoring-role"
      action_map:
        - name: passrole
          text: PassRole
          permissions:
            - iam:PassRole
    ec2:
      text: EC2
      description: ""
      inputs:
        - name: resource_arn
          type: text_input
          text: EC2 resource you need access to
          required: true
          default: "*"
      action_map:
        - name: volmount
          text: VolMount
          permissions:
            - ec2:attachvolume
            - ec2:createvolume
            - ec2:describelicenses
            - ec2:describevolumes
            - ec2:detachvolume
            - ec2:reportinstancestatus
            - ec2:resetsnapshotattribute
        - name: ipv6
          text: Enable IPv6
          permissions:
            - ec2:AssignIpv6Addresses
    route53:
      text: Route53
      description: ""
      inputs:
        - name: resource_arn
          type: text_input
          text: Route53 Domain you need access to
          required: true
          default: "*"
      action_map:
        - name: list_records
          text: List Records
          permissions:
            - route53:listresourcerecordsets
        - name: change_records
          text: Change Records
          permissions:
            - route53:changeresourcerecordsets
    sts:
      text: STS AssumeRole
      description: ""
      inputs:
        - name: resource_arn
          type: typeahead_input
          text: Role ARN that you wish to assume
          required: true
          typeahead_endpoint: /policies/typeahead?resource=iam_arn&search={query}
      action_map:
        - name: assume_role
          text: Assume Role
          permissions:
            - sts:AssumeRole
    ses:
      text: SES - Send Email
      inputs:
        - name: from_address
          type: text_input
          text: Email Address to send from
          required: true
          default: "emailaddress@example.com"
        - name: resource_arn
          type: text_input
          text: ARN of the resource to send from
          required: true
      condition:
        StringLike:
          ses:FromAddress: "{from_address}"
      action_map:
        - name: send_email
          text: Send Email
          permissions:
            - ses:SendEmail
            - ses:SendRawEmail
    crud_lookup:
      text: Other
      description: |-
        Define the service (rds, route53, rekognition, etc), the resource (An ARN or a wildcard), and the list of actions
        (List, Read, Write, Permissions Management, Tagging) that you need access to. If you know the specific IAM
        permissions you need, use "Advanced Mode" from the dropdown instead.
      inputs:
        - name: service_name
          type: typeahead_input
          text: Service (s3, sqs, sns, rekognition, etc)
          required: true
          typeahead_endpoint: /api/v1/policyuniverse/autocomplete/?only_filter_services=true&prefix={query}
        - name: resource_arn
          type: text_input
          text: Resource ARN or Wildcard (*)
          required: true
          default: "*"
      action_map:
        - name: list
          text: List
          permissions:
            - List
        - name: read
          text: Read
          permissions:
            - Read
        - name: write
          text: Write
          permissions:
            - Write
        - name: permissions-management
          text: Permissions Management
          permissions:
            - Permissions management
        - name: tagging
          text: Tagging
          permissions:
            - Tagging

# In your deployment, you'll probably want to move these to Dynamic Configuration at
# https://YOUR_CONSOLEME_DOMAIN/config
permission_templates:
  default:
    default: true
    label: Default Template
    policy: |-
      {
           "Statement":[
               {
                   "Action":[
                       ""
                   ],
                   "Effect":"Allow",
                   "Resource": [
                       ""
                   ]
               }
           ],
           "Version":"2012-10-17"
       }
  s3write:
    label: S3 Write Access
    policy: |-
      {
          "Statement":[
              {
                  "Action":[
                      "s3:ListBucket",
                      "s3:GetObject",
                      "s3:PutObject",
                      "s3:DeleteObject"
                  ],
                  "Effect":"Allow",
                  "Resource":[
                      "arn:aws:s3:::BUCKET_NAME",
                      "arn:aws:s3:::BUCKET_NAME/OPTIONAL_PREFIX/\*"
                  ],
                  "Sid":"s3readwrite"
              }
          ]
      }
  s3read:
    label: S3 Read Access
    policy: |-
      {
          "Statement":[
              {
                  "Action":[
                      "s3:ListBucket",
                      "s3:GetObject"
                  ],
                  "Effect":"Allow",
                  "Resource":[
                      "arn:aws:s3:::BUCKET_NAME",
                      "arn:aws:s3:::BUCKET_NAME/OPTIONAL_PREFIX/\*"
                  ],
                  "Sid":"s3readonly"
              }
          ]
      }
  sqs:
    label: SQS
    policy: |-
      {
        "Statement": [
          {
            "Action": [
              "sqs:ReceiveMessage",
              "sqs:SendMessage",
              "sqs:DeleteMessage",
              "sqs:GetQueueUrl",
              "sqs:GetQueueAttributes"
            ],
            "Effect": "Allow",
            "Resource": "QUEUE_ARN"
          }
        ]
      }
  sns:
    label: SNS
    policy: |-
      {
        "Statement": [
          {
            "Action": [
              "sns:Publish",
              "sns:Subscribe",
              "sns:Unsubscribe"
            ],
            "Effect": "Allow",
            "Resource": "TOPIC_ARN"
          }
        ]
      }
  rdspassrole:
    label: RDS Monitoring PassRole
    policy: |-
      {
        "Statement": [
          {
            "Action": [
              "iam:PassRole"
            ],
            "Effect": "Allow",
            "Resource": "arn:aws:iam::<ACCOUNTID>:role/rds-monitoring-role"
          }
        ]
      }
  ses:
    label: SES
    policy: |-
      {
          "Statement": [
              {
                  "Action": [
                      "ses:SendEmail",
                      "ses:SendRawEmail"
                  ],
                  "Effect": "Allow",
                  "Resource": "arn:aws:ses:*:123456789012:identity/saasmail.netflix.com",
                  "Condition": {
                      "StringLike": {
                          "ses:FromAddress": "SENDER@saasmail.netflix.com"
                      }
                  }
              }
          ]
      }
  sts:
    label: STS - Assume role
    policy: |-
      {
          "Statement": [
              {
                  "Action": [
                      "sts:AssumeRole"
                  ],
                  "Effect": "Allow",
                  "Resource": "arn:aws:iam::ACCOUNT_NUMBER:role/ROLE"
              }
          ]
      }
  route53:
    label: Route53 List/Change Record Sets
    policy: |-
      {
          "Statement": [
              {
                  "Action": [
                      "route53:changeresourcerecordsets",
                      "route53:listresourcerecordsets"
                  ],
                  "Resource": [
                      "*"
                  ],
                  "Effect": "Allow"
              }
          ]
      }
  ec2_create_volume:
    label: EC2 Volmount
    policy: |-
      {
          "Statement": [
              {
                  "Action": [
                      "ec2:attachvolume",
                      "ec2:createvolume",
                      "ec2:describelicenses",
                      "ec2:describevolumes",
                      "ec2:detachvolume",
                      "ec2:reportinstancestatus",
                      "ec2:resetsnapshotattribute"
                  ],
                  "Resource": [
                      "*"
                  ],
                  "Effect": "Allow"
              }
          ]
      }
  put_cloudwatch_data:
    label: Cloudwatch - putmetricdata
    policy: |-
      {
          "Statement":[
              {
                  "Action":[
                      "cloudwatch:putmetricdata"
                  ],
                  "Effect":"Allow",
                  "Resource":[
                      "*"
                  ]
              }
          ],
          "Version":"2012-10-17"
      }
  eni_auto_attach:
    label: ENI - Auto attach
    policy: |-
      {
          "Statement":[
              {
                  "Action":[
                      "ec2:AttachNetworkInterface",
                      "ec2:Describe*",
                      "ec2:DetachNetworkInterface"
                  ],
                  "Effect":"Allow",
                  "Resource":[
                      "*"
                  ],
                  "Sid":"eniauto"
              }
          ],
          "Version":"2012-10-17"
      }
  ec2_ipv6:
    label: EC2 - AssignIpv6Addresses
    policy: |-
      {
          "Statement":[
              {
                  "Action":[
                      "ec2:AssignIpv6Addresses"
                  ],
                  "Effect":"Allow",
                  "Resource":[
                      "*"
                  ]
              }
          ]
      }
  volmount:
    label: EC2 - volmount
    policy: |-
      {
          "Statement":[
              {
                  "Action":[
                        "ec2:attachvolume",
                        "ec2:createsnapshot",
                        "ec2:createtags",
                        "ec2:createvolume",
                        "ec2:deletesnapshot",
                        "ec2:describeinstances",
                        "ec2:describetags",
                        "ec2:describevolumes",
                        "ec2:modifyinstanceattribute"
                  ],
                  "Effect":"Allow",
                  "Resource":[
                      "*"
                  ]
              }
          ]
      }

ses:
  support_reference: "Please contact us at consoleme@example.com if you have any questions or concerns."
  arn: "arn:aws:ses:us-east-1:123456789012:identity/example.com"
  from_address_placeholder: fromaddress@example.com
